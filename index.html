<!DOCTYPE html>
<html lang="rw">
<head>
  <!--
    Landing Page (index.html) â€” Boutique LP yihariye, ikomeye, kandi ifite ubwenge
    Byubakiwe mu: HTML + CSS + JavaScript gusa
    Imikorere: Puter.js style logic (chatbot), Web Speech API, localStorage
    Ijwi rya greeting: Igifaransa | Ijwi rya chatbot: Kiswahili (option Kinyarwanda & FranÃ§ais available)
    Ukoresheje comments zisobanura buri section, responsive & mobile-friendly, dark mode, animations, smooth scrolling
  -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boutique Gihosha Gisandema â€” LP yâ€™Ubwenge</title>
  <meta name="description" content="Boutique yâ€™Ubwenge: yakira abakiriya, ibaganiriza, ibereka stock, isubiza ibibazo, igakora amafoto hashingiwe ku bisobanuro.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    /* ===========================
       Base & Theme
       =========================== */
    :root{
      --bg: #0b0f14;
      --bg-soft: #121820;
      --fg: #e8eef7;
      --muted: #a9b6c7;
      --primary: #6bd1ff;
      --accent: #7cf29a;
      --danger: #ff6b6b;
      --shadow: 0 20px 40px rgba(0,0,0,0.35);
      --radius: 16px;
    }
    [data-theme="light"]{
      --bg: #f7fbff;
      --bg-soft: #eef3f9;
      --fg: #0c1520;
      --muted: #4a5b70;
      --primary: #0066ff;
      --accent: #0bbf72;
      --danger: #d53d3d;
    }
    *{box-sizing:border-box}
    html, body{
      margin:0; padding:0;
      background: var(--bg);
      color: var(--fg);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      scroll-behavior: smooth;
    }
    a{color: var(--primary); text-decoration:none}
    img, video{max-width:100%; display:block}
    button{
      border:0; cursor:pointer; border-radius: 999px;
      background: var(--primary); color: white; padding: 12px 20px; font-weight: 700;
      box-shadow: var(--shadow);
    }
    button:focus-visible{outline: 3px solid var(--accent)}
    .container{width: min(1100px, 92vw); margin: 0 auto}

    /* ===========================
       Hero â€” Video background & overlay
       =========================== */
    .hero{
      position: relative; min-height: 92vh; display:flex; align-items:center; justify-content:center;
      background: #000; overflow: hidden;
    }
    .hero video{
      position:absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; filter: brightness(0.6) saturate(1.2);
    }
    .hero .fallback{
      position:absolute; inset:0; background:url('fallback.jpg') center/cover no-repeat; filter: brightness(0.6);
      display:none;
    }
    .no-video .hero video{display:none}
    .no-video .hero .fallback{display:block}

    .overlay{
      position:relative; z-index:1; text-align:center; padding: 40px 24px;
    }
    .badge{
      display:inline-flex; gap:8px; align-items:center; padding:8px 14px; background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.18); border-radius: 999px; backdrop-filter: blur(4px);
    }
    .title{font-size: clamp(32px, 6vw, 56px); margin:18px 0 6px; font-weight:800; letter-spacing:-0.02em}
    .subtitle{color: var(--muted); font-size: clamp(16px, 3.2vw, 20px); margin-bottom: 24px}
    .cta-group{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .ghost{
      background: transparent; border: 2px solid rgba(255,255,255,0.35); color: var(--fg); box-shadow:none;
    }
    .toolbar{
      position: fixed; top: 16px; right: 16px; display: flex; gap: 8px; z-index: 9;
    }
    .toggle{
      background: var(--bg-soft); color: var(--fg); border:1px solid rgba(255,255,255,0.16);
    }

    /* ===========================
       Sections wrapper & reveal animation
       =========================== */
    section{
      padding: 80px 0; background: var(--bg);
    }
    .card{
      background: var(--bg-soft); border:1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 24px;
    }
    .grid{
      display:grid; gap: 18px;
    }
    .two{
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .reveal{
      opacity: 0; transform: translateY(24px); transition: 680ms ease;
    }
    .reveal.in{
      opacity: 1; transform: translateY(0);
    }

    /* ===========================
       Stock table
       =========================== */
    .stock-controls{display:flex; gap:10px; align-items:center; margin-bottom: 12px; flex-wrap: wrap}
    .stock-controls input{
      flex:1; padding: 10px 14px; border-radius: 10px; border:1px solid rgba(255,255,255,0.16);
      background: var(--bg); color: var(--fg);
    }
    table{width:100%; border-collapse: collapse}
    thead th{
      text-align:left; padding: 12px; font-weight:700; color: var(--muted); border-bottom:1px solid rgba(255,255,255,0.12)
    }
    tbody td{padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.08)}
    tbody tr{transition: 400ms ease; transform: translateY(8px); opacity: 0}
    tbody tr.in{transform:none; opacity:1}
    .price{font-weight:800; color: var(--accent)}
    .thumb{width:68px; height:68px; border-radius: 12px; object-fit: cover; border:1px solid rgba(255,255,255,0.16)}

    /* ===========================
       Testimonials
       =========================== */
    .stars{color:#f9cc45; font-size: 18px}
    .emoji{font-size: 22px}

    /* ===========================
       Joke spinner
       =========================== */
    .joke-box{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .joke-text{flex:1}

    /* ===========================
       Chatbot
       =========================== */
    .chat-wrap{display:grid; grid-template-columns: 1fr; gap:16px}
    .chat-log{
      height: 320px; overflow:auto; background: var(--bg-soft);
      border:1px solid rgba(255,255,255,0.1); border-radius: var(--radius); padding: 16px;
    }
    .msg{margin-bottom: 12px}
    .msg .sender{font-weight:700}
    .msg .content{margin-top: 4px}
    .chat-controls{display:flex; gap:8px; flex-wrap:wrap}
    .chat-controls input{
      flex:1; padding: 12px 14px; border-radius: 10px; border:1px solid rgba(255,255,255,0.16);
      background: var(--bg); color: var(--fg);
    }
    .tiny{padding: 10px 14px}

    /* ===========================
       Contact + Support
       =========================== */
    form input, form textarea{
      width:100%; padding: 12px 14px; border-radius: 10px; border:1px solid rgba(255,255,255,0.16);
      background: var(--bg); color: var(--fg); margin-bottom:10px;
    }
    form textarea{min-height: 120px; resize: vertical}
    .support{
      display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    /* ===========================
       Footer
       =========================== */
    footer{
      padding: 40px 0; background: var(--bg-soft); border-top: 1px solid rgba(255,255,255,0.08)
    }
    .footer-grid{display:grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr))}
    .icons a{margin-right: 10px; display:inline-block}
    .qr{width: 140px; height: auto; border-radius: 12px; border:1px solid rgba(255,255,255,0.16)}

    /* ===========================
       Responsive tweaks
       =========================== */
    @media (max-width: 560px){
      .title{font-size: 32px}
      .subtitle{font-size: 16px}
      .chat-log{height: 280px}
    }
  </style>
</head>
<body>
  <!-- ===========================
       Toolbar â€” Dark mode toggle and smooth anchor helpers
       =========================== -->
  <div class="toolbar">
    <button id="darkToggle" class="toggle" aria-label="Hindura dark mode">ğŸŒ™ Hindura Mode</button>
    <a href="#stock" class="toggle" aria-label="Jya kuri Stock">ğŸ›ï¸ Stock</a>
    <a href="#chatbot" class="toggle" aria-label="Jya kuri Chatbot">ğŸ¤– Chatbot</a>
  </div>

  <!-- ===========================
       Hero section â€” Video background + fallback + audio greeting (FR)
       =========================== -->
  <header class="hero" id="hero" aria-label="Hero section">
    <video id="bgVideo" autoplay muted loop playsinline poster="fallback.jpg">
      <!-- NOTE: You can replace src with your local MP4/WebM; poster is fallback image -->
      <source src="background.mp4" type="video/mp4">
      <source src="background.webm" type="video/webm">
    </video>
    <div class="fallback" aria-hidden="true"></div>

    <div class="overlay container reveal">
      <span class="badge">ğŸ§  Boutique yâ€™Ubwenge â€¢ ğŸš€ LP yihariye</span>
      <h1 class="title">Gihosha Gisandema Boutique</h1>
      <p class="subtitle">Dushorera kugiciro gito, turaguha serivisi yâ€™inyamwuga, amafoto yâ€™ibyo wifuza, nâ€™ijwi riguganiriza.</p>

      <div class="cta-group">
        <button id="ctaDeal">Dushorere kugiciro gito</button>
        <button id="playGreeting" class="ghost" aria-label="Kumva ikaze mu Gifaransa">ğŸ§ Kumva Ikaze (FR)</button>
      </div>
      <p class="subtitle">ğŸ“ Gihosha Gisandema â€¢ ğŸ•˜ Open: 8:00â€“19:00 â€¢ ğŸ“ +25771633859</p>
    </div>
  </header>

  <!-- ===========================
       Stock section â€” Embedded JSON, table, live search, animated entry
       =========================== -->
  <section id="stock" class="reveal" aria-label="Stock section">
    <div class="container">
      <h2>ğŸ›ï¸ Ibicuruzwa biri muri Stock</h2>
      <p class="subtitle">Shakisha ibicuruzwa byacu, urebe amashusho, ibisobanuro, nâ€™igiciro â€” byose bihita bigaragara.</p>

      <div class="card">
        <div class="stock-controls">
          <input id="stockSearch" type="search" placeholder="Shakisha (urugero: ikoti, inkweto, earphones)..." aria-label="Shakisha ibicuruzwa">
          <button id="refreshStock" class="tiny" aria-label="Ongera werekane byose">ğŸ”„ Ongera</button>
        </div>

        <table aria-label="Ibicuruzwa muri stock">
          <thead>
            <tr>
              <th>Image</th>
              <th>Izina</th>
              <th>Ibisobanuro</th>
              <th>Igiciro</th>
            </tr>
          </thead>
          <tbody id="stockBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===========================
       Feedback section â€” Testimonials, emojis & rating stars
       =========================== -->
  <section id="feedback" class="reveal" aria-label="Feedback section">
    <div class="container">
      <h2>ğŸ’¬ Ibyo abakiriya bavuga</h2>
      <div class="grid two">
        <div class="card">
          <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p><span class="emoji">ğŸ˜Š</span> â€œSerivisi nziza cane! Banshikirije igisubizo vuba kandi igiciro kiraryoshye.â€</p>
          <small>â€” Diane, Musaga</small>
        </div>
        <div class="card">
          <div class="stars">â˜…â˜…â˜…â˜…â˜†</div>
          <p><span class="emoji">ğŸ›ï¸</span> â€œIbicuruzwa bifise umwimerere, nashimye ko banyumvise mu Kinyarwanda.â€</p>
          <small>â€” AimÃ©, Kamenge</small>
        </div>
        <div class="card">
          <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p><span class="emoji">ğŸ¤</span> â€œWhatsApp autoresponder yandemeye vuba, byoroheje gusaba.â€</p>
          <small>â€” Carine, Kinindo</small>
        </div>
      </div>
    </div>
  </section>

  <!-- ===========================
       Daily Joke Spinner â€” Kirundi jokes, localStorage, speak button
       =========================== -->
  <section id="joke" class="reveal" aria-label="Daily joke section">
    <div class="container">
      <h2>ğŸ² Joke yâ€™umunsi (Kirundi)</h2>
      <div class="card joke-box">
        <div id="jokeText" class="joke-text">Iyo utazi igiciro, usaba igiceri â€” ariko wibuke ko hari discount ğŸ˜‰</div>
        <div style="display:flex; gap:8px">
          <button id="newJoke" class="tiny">ğŸ” Joke nshasha</button>
          <button id="speakJoke" class="tiny">ğŸ—£ï¸ Soma mu ijwi</button>
        </div>
      </div>
      <p class="subtitle">LocalStorage irinda ko jokes zisubirwamo kenshi kuri uwo munsi.</p>
    </div>
  </section>

  <!-- ===========================
       Chatbot section â€” Puter.js style logic, emojis, TTS, image generation
       =========================== -->
  <section id="chatbot" class="reveal" aria-label="Chatbot section">
    <div class="container">
      <h2>ğŸ¤– Chatbot yâ€™Ubwenge</h2>
      <p class="subtitle">Andika mu Kinyarwanda. Chatbot izagutahura, isubize mu nyandiko, kandi uvunja mu ijwi rya Kiswahili cyangwa FranÃ§ais uko ubishaka.</p>

      <div class="chat-wrap">
        <div id="chatLog" class="chat-log" aria-live="polite" aria-label="Imiganiro ya chatbot"></div>

        <div class="card">
          <div class="chat-controls">
            <input id="chatInput" type="text" placeholder="Andika ikibazo cyangwa ibyo wifuza (urugero: â€˜Nshaka ikoti ryâ€™umukaraâ€™)..." aria-label="Icyinjizo cya chatbot">
            <button id="sendBtn" class="tiny">ğŸ“© Ohereza</button>
            <button id="voiceBtn" class="tiny" title="Vuga igisubizo mu FranÃ§ais">ğŸ”Š Voice (FR)</button>
            <button id="voiceSwBtn" class="tiny" title="Vuga igisubizo mu Kiswahili">ğŸ”Š Voice (SW)</button>
            <button id="voiceRwBtn" class="tiny" title="Vuga igisubizo mu Kinyarwanda">ğŸ”Š Voice (RW)</button>
            <button id="imgGenBtn" class="tiny" title="Gukora ifoto hashingiwe ku bisobanuro">ğŸ–¼ï¸ Kora Ifoto</button>
          </div>
          <small style="color:var(--muted)">Emojis ziterwa nâ€™ibyo wavuze. Ibisubizo bijyanye na stock birakurwamo kuri JSON iri muri iyi page.</small>
        </div>
      </div>
    </div>
  </section>

  <!-- ===========================
       Google Maps Embed â€” Gihosha Gisandema (coords provided)
       =========================== -->
  <section id="map" class="reveal" aria-label="Google map section">
    <div class="container">
      <h2>ğŸ—ºï¸ Aho duherereye</h2>
      <p class="subtitle">Gihosha Gisandema â€” Latitude -3.36392Â°, Longitude 29.378</p>

      <div class="card">
        <!-- NOTE: Replace the embed with your Google Maps share link if needed -->
        <iframe
          title="Gihosha Gisandema Location"
          src="https://www.google.com/maps?q=-3.36392,29.378&z=16&output=embed"
          width="100%" height="380" style="border:0" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </div>
  </section>

  <!-- ===========================
       Contact & WhatsApp Support â€” FormSubmit.io, wa.me autoresponder
       =========================== -->
  <section id="contact" class="reveal" aria-label="Contact & support section">
    <div class="container">
      <h2>ğŸ“¬ Twandikire & Support</h2>
      <div class="grid two">
        <div class="card">
          <h3>Form yo kutwandikira</h3>
          <!-- FormSubmit.io: replace action with your endpoint if you have custom -->
          <form id="contactForm" action="https://formsubmit.co/ornoirbruce5@gmail.com" method="POST">
            <input type="hidden" name="_subject" id="subjectField" value="S/N: GIHOSHA DEAL â€” Umukiriya mushya">
            <input type="text" name="name" placeholder="Izina ryawe" required>
            <input type="email" name="email" placeholder="Email yawe" required>
            <textarea name="message" placeholder="Ubutumwa bwawe..." required></textarea>
            <button type="submit">ğŸ“¨ Ohereza</button>
          </form>
          <small style="color:var(--muted)">Iyo ukanda kuri CTA â€œDushorere kugiciro gitoâ€, subject irahita yuzura.</small>
        </div>

        <div class="card">
          <h3>WhatsApp Support</h3>
          <div class="support">
            <div>
              <p>ğŸ‘‰ Autoresponder:</p>
              <a class="toggle" href="https://wa.me/25771633859?text=Mwaramutse%2C%20nkeneye%20ubufasha%20ku%20bicuruzwa%20by%27i%20Gihosha%20Gisandema.%20Nshaka%20igiciro%20n%27ibihari%20muri%20stock." target="_blank" rel="noopener">ğŸ’¬ Tuganire kuri WhatsApp</a>
            </div>
            <div>
              <p>ğŸ› ï¸ Maintenance & Support:</p>
              <p class="subtitle">Dufasha guhora havugururwa stock, imikorere ya chatbot, na audio services.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===========================
       Footer â€” Contact info, social icons, WhatsApp QR
       =========================== -->
  <footer aria-label="Footer">
    <div class="container footer-grid">
      <div>
        <h3>Twihutire Kugufasha</h3>
        <p>ğŸ“ +25771633859</p>
        <p>ğŸ“§ ornoirbruce5@gmail.com</p>
        <p>ğŸ“ Gihosha Gisandema</p>
      </div>
      <div>
        <h3>Imbuga Nkoranyambaga</h3>
        <div class="icons">
          <a href="https://wa.me/25771633859" target="_blank" rel="noopener">ğŸŸ¢ WhatsApp</a>
          <a href="#" target="_blank" rel="noopener">ğŸŸ£ Instagram</a>
          <a href="#" target="_blank" rel="noopener">ğŸ”µ Facebook</a>
        </div>
      </div>
      <div>
        <h3>QR Code ya WhatsApp</h3>
        <!-- Replace src with your actual QR image file -->
        <img class="qr" src="whatsapp-qr.jpg" alt="WhatsApp QR Code">
      </div>
    </div>
    <div class="container" style="margin-top: 10px;">
      <small style="color:var(--muted)">Â© 2025 Gihosha Gisandema Boutique â€” LP yâ€™Ubwenge</small>
    </div>
  </footer>

  <!-- ===========================
       Embedded JSON â€” Stock data (images, description, price)
       =========================== -->
  <script id="stock-json" type="application/json">
  {
    "products": [
      {
        "name": "Ikoti ry'umukara",
        "desc": "Ikoti rimeze neza, ridahenda, rifashe kuri byose.",
        "price": "45,000 FBu",
        "img": "https://images.unsplash.com/photo-1520975922215-c4f0b3c2a9a0?q=80&w=600&auto=format&fit=crop"
      },
      {
        "name": "Inkweto za sport",
        "desc": "Inkweto zoroshye zo kwiruka no kugenda buri munsi.",
        "price": "60,000 FBu",
        "img": "https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=600&auto=format&fit=crop"
      },
      {
        "name": "Earphones Bluetooth",
        "desc": "Earphones z'umuyagankuba, zifite amajwi meza.",
        "price": "35,000 FBu",
        "img": "https://images.unsplash.com/photo-1518441902110-74805b240b87?q=80&w=600&auto=format&fit=crop"
      },
      {
        "name": "Imipira (T-shirts)",
        "desc": "Imipira yoroheje, amabara menshi ahari.",
        "price": "18,000 FBu",
        "img": "https://images.unsplash.com/photo-1520975954738-719aa237a7c8?q=80&w=600&auto=format&fit=crop"
      },
      {
        "name": "Amasaha (Smartwatch)",
        "desc": "Smartwatch ifasha kuri sport no kumenya messages.",
        "price": "85,000 FBu",
        "img": "https://images.unsplash.com/photo-1515879218367-8466d910aaa2?q=80&w=600&auto=format&fit=crop"
      }
    ]
  }
  </script>

  <!-- ===========================
       Main Script â€” Interactivity, Chatbot logic, TTS, Animations
       =========================== -->
  <script>
    /* ---------------------------------------
       Utility: Safe query selectors
    --------------------------------------- */
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    /* ---------------------------------------
       Dark mode toggle
    --------------------------------------- */
    const darkToggle = $('#darkToggle');
    const root = document.documentElement;
    const THEME_KEY = 'lp-theme';
    const savedTheme = localStorage.getItem(THEME_KEY);
    if(savedTheme){ root.setAttribute('data-theme', savedTheme); }
    darkToggle.addEventListener('click', ()=>{
      const current = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      root.setAttribute('data-theme', current);
      localStorage.setItem(THEME_KEY, current);
    });

    /* ---------------------------------------
       Video fallback detection
    --------------------------------------- */
    const bgVideo = $('#bgVideo');
    bgVideo?.addEventListener('error', ()=>{
      document.body.classList.add('no-video');
    });
    // If autoplay fails (mobile), mute is already true; keep poster fallback.

    /* ---------------------------------------
       Reveal animations via IntersectionObserver
    --------------------------------------- */
    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          if(e.target.tagName === 'SECTION'){
            // Animate rows in stock table when section becomes visible
            if(e.target.id === 'stock'){
              setTimeout(()=> $$('#stockBody tr').forEach((tr,i)=> setTimeout(()=> tr.classList.add('in'), 60*i)), 120);
            }
          }
        }
      });
    }, { threshold: 0.12 });
    $$('.reveal').forEach(el=> io.observe(el));

    /* ---------------------------------------
       Audio greeting (French) â€” Web Speech API
    --------------------------------------- */
    const playGreetingBtn = $('#playGreeting');
    let voices = [];
    function loadVoices(){
      voices = window.speechSynthesis.getVoices();
    }
    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    function speak(text, langHint='fr-FR'){
      const utter = new SpeechSynthesisUtterance(text);
      // Try pick voice by language hint
      const v = voices.find(v=> v.lang && v.lang.toLowerCase().startsWith(langHint.toLowerCase()));
      if(v){ utter.voice = v; }
      utter.rate = 1.0; utter.pitch = 1.0;
      window.speechSynthesis.speak(utter);
    }

    playGreetingBtn.addEventListener('click', ()=>{
      speak("Bienvenue chez la Boutique Gihosha Gisandema. Nous offrons des prix avantageux et un service chaleureux. Comment puis-je vous aider aujourd'hui ?", 'fr-FR');
    });

    /* ---------------------------------------
       CTA â€” Prefill subject for FormSubmit
    --------------------------------------- */
    $('#ctaDeal').addEventListener('click', ()=>{
      const subj = $('#subjectField');
      subj.value = "GIHOSHA DEAL â€” Ndi umukiriya nshaka kuganira ku giciro gito";
      // Optional gentle feedback
      alert("Subject ya email yuzuye: â€˜GIHOSHA DEALâ€™. Ushobora kudusaba igiciro gito ubungubu.");
      // Smooth jump to contact
      location.hash = '#contact';
    });

    /* ---------------------------------------
       Stock â€” Parse embedded JSON, render table, live search
    --------------------------------------- */
    const stockData = JSON.parse($('#stock-json').textContent);
    const stockBody = $('#stockBody');
    function renderStock(list){
      stockBody.innerHTML = list.map(item=> `
        <tr>
          <td><img class="thumb" src="${item.img}" alt="${item.name}"></td>
          <td>${item.name}</td>
          <td>${item.desc}</td>
          <td class="price">${item.price}</td>
        </tr>
      `).join('');
      // Animate in rows (IntersectionObserver also triggers)
      $$('#stockBody tr').forEach((tr,i)=> setTimeout(()=> tr.classList.add('in'), 60*i));
    }
    renderStock(stockData.products);

    $('#stockSearch').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase();
      const filtered = stockData.products.filter(p =>
        [p.name, p.desc, p.price].join(' ').toLowerCase().includes(q)
      );
      renderStock(filtered);
    });
    $('#refreshStock').addEventListener('click', ()=> renderStock(stockData.products));

    /* ---------------------------------------
       Joke Spinner â€” Kirundi jokes with localStorage (no repeat per day)
    --------------------------------------- */
    const JOKES = [
      "Umucuruzi yabwiye umukiriya: â€˜Igiciro gito ni kâ€™ukubita ikiganzaâ€™ â€” ati: â€˜Ndakira!â€™ ğŸ˜„",
      "Ujanye amafaranga make, kora ku discount menshi nâ€™ugushishoza ğŸ˜‰",
      "Niwumva igiciro kikurusha, hamagara chatbot iguhe inama ğŸ˜‚",
      "Ibintu vyiza birihuta gushira â€” shora vuba, uraronka kâ€™ugushimisha ğŸ˜",
      "Uwaje ubwa mbere ahabwa ikaze nâ€™agaseke kâ€™akarusho ğŸ¤—"
    ];
    const jokeText = $('#jokeText');
    const JOKE_KEY = 'lp-joke-date-index';
    function todaysKey(){ const d = new Date(); return d.toISOString().slice(0,10); }
    function pickJoke(){
      const key = todaysKey();
      const stored = localStorage.getItem(JOKE_KEY);
      if(stored){
        const obj = JSON.parse(stored);
        if(obj.date === key){ return JOKES[obj.index]; }
      }
      const idx = Math.floor(Math.random() * JOKES.length);
      localStorage.setItem(JOKE_KEY, JSON.stringify({date:key, index:idx}));
      return JOKES[idx];
    }
    jokeText.textContent = pickJoke();
    $('#newJoke').addEventListener('click', ()=> jokeText.textContent = pickJoke());
    $('#speakJoke').addEventListener('click', ()=> speak(jokeText.textContent, 'rw-RW'));

    /* ---------------------------------------
       Chatbot â€” Puter.js style logic (intent, emojis, TTS, stock QA, image generation)
       - Text answers: Kinyarwanda
       - Voice buttons: FR (speech), SW (Kiswahili), RW (Kinyarwanda)
       - Image generation: placeholder using description + stock/Unsplash
    --------------------------------------- */
    const chatLog = $('#chatLog');
    const chatInput = $('#chatInput');
    const sendBtn = $('#sendBtn');
    const voiceBtnFR = $('#voiceBtn');
    const voiceBtnSW = $('#voiceSwBtn');
    const voiceBtnRW = $('#voiceRwBtn');
    const imgGenBtn = $('#imgGenBtn');

    function addMsg(sender, text){
      const div = document.createElement('div');
      div.className = 'msg';
      div.innerHTML = `<div class="sender">${sender}</div><div class="content">${text}</div>`;
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
      return div;
    }

    // Emoji enrichment based on keywords
    function emojiFor(text){
      const t = text.toLowerCase();
      if(t.includes('ikoti') || t.includes('coat')) return 'ğŸ§¥';
      if(t.includes('inkweto') || t.includes('shoes')) return 'ğŸ‘Ÿ';
      if(t.includes('earphones') || t.includes('amaso') || t.includes('bluetooth')) return 'ğŸ§';
      if(t.includes('giciro') || t.includes('price') || t.includes('discount')) return 'ğŸ’¸';
      if(t.includes('mwaramutse') || t.includes('bonjour') || t.includes('salut')) return 'ğŸ‘‹';
      if(t.includes('smartwatch') || t.includes('amasaha')) return 'âŒš';
      return 'âœ¨';
    }

    // Simple intent detection (Kinyarwanda)
    function intent(text){
      const t = text.toLowerCase();
      if(/mwaramutse|amakuru|ndamutse|bonjour|salut/.test(t)) return 'greet';
      if(/giciro|price|ingahe|cost/.test(t)) return 'price';
      if(/hari|available|ihari|stock|muri stock|muhari/.test(t)) return 'availability';
      if(/shaka|nshaka|ndashaka|gura|buy|purchase|order/.test(t)) return 'buy';
      if(/ifoto|image|photo|kora ifoto|shusho/.test(t)) return 'image';
      if(/ubufasha|help|support|whatsapp/.test(t)) return 'support';
      return 'chat';
    }

    // Find product by fuzzy match
    function findProduct(text){
      const t = text.toLowerCase();
      return stockData.products.find(p => [p.name, p.desc].join(' ').toLowerCase().includes(t));
    }

    // Generate Kinyarwanda answer for intent
    function answerKN(text){
      const i = intent(text);
      const emoji = emojiFor(text);
      if(i === 'greet'){
        return `${emoji} Mwaramutse! Murakaza neza kuri Boutique Gihosha Gisandema. Ndabafasha iki uyu munsi?`;
      }
      if(i === 'price'){
        const p = findProduct(text);
        if(p) return `${emoji} Igiciro cya â€œ${p.name}â€ ni ${p.price}. Mushobora kuyitegera ku giciro cyiza.`;
        return `${emoji} Igiciro giterwa n'igicuruzwa. Mumbwire izina ryacyo kugira ndabagezeho igiciro nyacyo.`;
      }
      if(i === 'availability'){
        const p = findProduct(text);
        if(p) return `${emoji} â€œ${p.name}â€ irahari muri stock. Mwifuza ubunini cyangwa ibara ryihariye?`;
        return `${emoji} Dushobora kureba bihari. Andikaho izina ry'igicuruzwa ushaka.`;
      }
      if(i === 'buy'){
        const p = findProduct(text);
        if(p) return `${emoji} Neza! Turashobora kubika â€œ${p.name}â€ ku izina ryawe. Ushaka ko tuganira kuri WhatsApp?`;
        return `${emoji} Ushaka kugura iki? Uduhe izina ryâ€™igicuruzwa, tuhamagare cyangwa dukoreshe WhatsApp ako kanya.`;
      }
      if(i === 'image'){
        const p = findProduct(text);
        if(p) return `${emoji} Ndakwereka ifoto y'icyo wifuza: â€œ${p.name}â€. Kanda â€˜ğŸ–¼ï¸ Kora Ifotoâ€™ hejuru, cyangwa reba ifoto iri muri stock.`;
        return `${emoji} Sobanura ibyo wifuza mu ifoto (urugero: â€˜ikoti ryâ€™umukara rifite zipperâ€™) hanyuma nkore ishusho.`;
      }
      if(i === 'support'){
        return `${emoji} Ubufasha burahari: kanda kuri â€˜ğŸ’¬ Tuganire kuri WhatsAppâ€™ muri Support, cyangwa wandike hano uburenganzira bwawe.`;
      }
      // Generic chat
      return `${emoji} Ndumva neza. Munsobanurire neza icyo mwifuza: izina ryâ€™igicuruzwa, igiciro, cyangwa ifoto yâ€™icyo mushaka.`;
    }

    // Voice helpers
    function speakFR(text){ speak(text, 'fr-FR'); }
    function speakSW(text){ speak(text, 'sw-TZ'); } // Kiswahili voice hint (may vary per device)
    function speakRW(text){ speak(text, 'rw-RW'); } // Kinyarwanda (may fall back if unavailable)

    // On send
    function handleSend(){
      const userText = chatInput.value.trim();
      if(!userText) return;
      addMsg('ğŸ‘¤ Umukiriya', userText);
      const botText = answerKN(userText);
      const node = addMsg('ğŸ¤– Boutique Bot', botText);
      // If the user asked about image, attach preview suggestion
      if(intent(userText) === 'image'){
        const p = findProduct(userText);
        const imgUrl = p?.img || suggestImage(userText);
        const img = document.createElement('img');
        img.src = imgUrl; img.alt = 'Image suggestion';
        img.style.cssText = 'margin-top:8px; width: 220px; border-radius:12px; border:1px solid rgba(255,255,255,0.16)';
        node.appendChild(img);
      }
      chatInput.value = '';
    }
    sendBtn.addEventListener('click', handleSend);
    chatInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') handleSend(); });

    // Voice buttons: speak last bot message
    function lastBotText(){
      const messages = Array.from(chatLog.querySelectorAll('.msg .sender'));
      for(let i=messages.length-1; i>=0; i--){
        if(messages[i].textContent.includes('Boutique Bot')){
          return messages[i].nextElementSibling.textContent.trim();
        }
      }
      return 'Nta butumwa bwa bot buraboneka.';
    }
    voiceBtnFR.addEventListener('click', ()=> speakFR(lastBotText()));
    voiceBtnSW.addEventListener('click', ()=> speakSW(lastBotText()));
    voiceBtnRW.addEventListener('click', ()=> speakRW(lastBotText()));

    // Image generation â€” puter.ai.txt2img style placeholder + stock fallback
    function suggestImage(prompt){
      // Basic keyword-based Unsplash suggestion (placeholder). Replace with your txt2img endpoint if available.
      const q = encodeURIComponent(prompt.toLowerCase()
        .replace(/[^a-z0-9\s]/g,'')
        .split(' ').slice(0,4).join(' '));
      return `https://source.unsplash.com/600x400/?${q || 'product'}`;
    }
    imgGenBtn.addEventListener('click', ()=>{
      const lastUser = Array.from(chatLog.querySelectorAll('.msg .sender'))
        .find((s)=> s.textContent.includes('Umukiriya'));
      const basePrompt = lastUser ? lastUser.nextElementSibling.textContent : 'product image';
      const url = suggestImage(basePrompt);
      const node = addMsg('ğŸ–¼ï¸ Generator', `Ishusho ishingiye ku bisobanuro byawe: ${basePrompt}`);
      const img = document.createElement('img');
      img.src = url; img.alt = 'Generated suggestion';
      img.style.cssText = 'margin-top:8px; width: 240px; border-radius:12px; border:1px solid rgba(255,255,255,0.16)';
      node.appendChild(img);
    });

    /* ---------------------------------------
       Smooth scroll already enabled via CSS
    --------------------------------------- */
  </script>
</body>
</html>
